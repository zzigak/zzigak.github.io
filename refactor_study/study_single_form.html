<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Refactoring Study - Compare Code</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css">
    <style>
        /* Mobile detection for study page */
        .mobile-block {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 1.5rem;
            max-width: 90%;
            width: 400px;
            box-shadow: var(--shadow-sm);
            z-index: 10000;
        }
        
        .mobile-block h3 {
            font-size: 1.125rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }
        
        .mobile-block p {
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }
        
        @media (max-width: 768px), (pointer: coarse) and (hover: none) {
            .mobile-block {
                display: block;
            }
            
            .study-container {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <!-- Mobile Block Message -->
    <div class="mobile-block">
        <h3>üñ•Ô∏è Desktop Required</h3>
        <p>This study needs a larger screen to display three code panels side-by-side.</p>
        <p>Please continue on a desktop or laptop computer.</p>
    </div>
    
    <div class="study-container">
        <header class="study-header">
            <div class="progress-info">
                <span class="progress-text">Question <span id="currentQuestion">1</span> of 10</span>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
            <div class="participant-info">
                <span>Participant: <strong id="participantId">-</strong></span>
                <span class="timer" id="timer">00:00</span>
            </div>
            <div class="controls-section">
                <div class="control-item font-controls">
                    <span>Font Size:</span>
                    <button class="font-btn" id="fontDecrease">‚àí</button>
                    <span id="fontSize">14px</span>
                    <button class="font-btn" id="fontIncrease">+</button>
                </div>
            </div>
        </header>
        
        <!-- Debug Info Box (only shown with ?debug=true parameter) -->
        <div id="debugInfo" style="display: none; background: #fef3c7; border: 2px solid #f59e0b; padding: 15px; margin: 10px 20px; border-radius: 8px; font-family: monospace; font-size: 14px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <strong style="color: #d97706;">üîç DEBUG INFO:</strong>
            <div style="margin-top: 8px;">
                <div><strong>Tuple ID:</strong> <span id="debugTupleId" style="color: #0891b2;"></span></div>
                <div><strong>Tuple Name:</strong> <span id="debugTupleName" style="color: #059669;"></span></div>
                <div><strong>Cluster:</strong> <span id="debugCluster" style="color: #0891b2;"></span></div>
                <div><strong>Pair Type:</strong> <span id="debugPairType" style="color: #7c3aed;"></span> | <strong>Pair ID:</strong> <span id="debugPairId" style="color: #7c3aed;"></span></div>
                <div><strong>V1 Metric:</strong> <span id="debugV1Metric" style="color: #dc2626;"></span> (<span id="debugV1Refactoring" style="color: #dc2626;"></span>)</div>
                <div><strong>V2 Metric:</strong> <span id="debugV2Metric" style="color: #dc2626;"></span> (<span id="debugV2Refactoring" style="color: #dc2626;"></span>)</div>
            </div>
        </div>
        
        <main class="study-main">
            <div class="code-comparison">
                <div class="code-panel original-panel">
                    <div class="panel-header original-header">
                        <h3>Original</h3>
                        <div class="view-buttons">
                            <button class="view-btn active" data-panel="original" data-view="all">ALL</button>
                            <button class="view-btn" data-panel="original" data-view="p1">P1</button>
                            <button class="view-btn" data-panel="original" data-view="p2">P2</button>
                            <button class="view-btn" data-panel="original" data-view="p3">P3</button>
                        </div>
                    </div>
                    <div class="code-wrapper">
                        <pre><code class="language-python" id="originalCode"></code></pre>
                    </div>
                </div>
                
                <div class="code-panel">
                    <div class="panel-header">
                        <h3>Version 1</h3>
                        <div class="view-buttons">
                            <button class="view-btn active" data-panel="v1" data-view="all">ALL</button>
                            <button class="view-btn" data-panel="v1" data-view="library">Library</button>
                            <button class="view-btn" data-panel="v1" data-view="p1">P1</button>
                            <button class="view-btn" data-panel="v1" data-view="p2">P2</button>
                            <button class="view-btn" data-panel="v1" data-view="p3">P3</button>
                        </div>
                    </div>
                    <div class="code-wrapper">
                        <pre><code class="language-python" id="v1Code"></code></pre>
                    </div>
                </div>
                
                <div class="code-panel">
                    <div class="panel-header">
                        <h3>Version 2</h3>
                        <div class="view-buttons">
                            <button class="view-btn active" data-panel="v2" data-view="all">ALL</button>
                            <button class="view-btn" data-panel="v2" data-view="library">Library</button>
                            <button class="view-btn" data-panel="v2" data-view="p1">P1</button>
                            <button class="view-btn" data-panel="v2" data-view="p2">P2</button>
                            <button class="view-btn" data-panel="v2" data-view="p3">P3</button>
                        </div>
                    </div>
                    <div class="code-wrapper">
                        <pre><code class="language-python" id="v2Code"></code></pre>
                    </div>
                </div>
            </div>
            
            <div class="selection-section">
                <h3>Which refactored version do you prefer?</h3>
                <div class="choice-buttons">
                    <button class="choice-btn" data-choice="v1">
                        <span class="choice-label">Version 1</span>
                        <span class="shortcut">Press 1</span>
                    </button>
                    <button class="choice-btn" data-choice="v2">
                        <span class="choice-label">Version 2</span>
                        <span class="shortcut">Press 2</span>
                    </button>
                </div>
            </div>
            
            <div class="navigation">
                <button id="prevBtn" class="nav-btn" disabled>Previous</button>
                <button id="nextBtn" class="nav-btn btn-primary" disabled>Next Question</button>
                <button id="submitBtn" class="nav-btn btn-submit" style="display: none;">Complete Study</button>
            </div>
        </main>
        
    </div>
    
    <!-- Loading indicator -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Loading code...</p>
    </div>
    
    <!-- Modal for final submission -->
    <div class="modal" id="submitModal" style="display: none;">
        <div class="modal-content">
            <h2>Study Complete!</h2>
            <p>Thank you for completing the refactoring preference study.</p>
            
            <!-- Debug Summary (only shown with debug mode) -->
            <div id="debugSummaryContainer" style="display: none; background: #e0f2fe; border: 1px solid #0284c7; padding: 15px; margin: 20px 0; border-radius: 8px; max-height: 300px; overflow-y: auto;">
                <h3 style="color: #0284c7; margin-top: 0;">üìä Debug Summary - Your Choices:</h3>
                <div id="debugSummary" style="font-family: monospace; font-size: 12px;">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
            
            <p>Your responses have been saved. Click below to submit them via Google Forms.</p>
            <div class="modal-actions">
                <button id="openFormBtn" class="btn btn-primary" style="padding: 1rem 2rem; font-size: 1.2rem;">Submit Answers!</button>
            </div>
            <p class="note">The form will open with all your responses pre-filled. Just review and click Submit.</p>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="js/study_single_form.js"></script>
</body>
</html>